(()=>{"use strict";function e(e){return function(t,o){let a;console.log(`Modificando protype ${t.constructor.name}\n             e adicionando getter para a propriedade ${o}`),Object.defineProperty(t,o,{get:function(){return a||(a=document.querySelector(e),console.log(`buscando elemento do DOM com o seletor \n                 ${e} para injetar em ${o}`)),a}})}}var t;!function(e){e[e.DOMINGO=0]="DOMINGO",e[e.SEGUNDA=1]="SEGUNDA",e[e.TERCA=2]="TERCA",e[e.QUARTA=3]="QUARTA",e[e.QUINTA=4]="QUINTA",e[e.SEXTA=5]="SEXTA",e[e.SABADO=6]="SABADO"}(t||(t={}));class o{constructor(e,t,o){this._data=e,this.quantidade=t,this.valor=o}static criaDe(e,t,a){const n=new Date(e.replace(/-/g,",")),i=parseInt(t),r=parseFloat(a);return new o(n,i,r)}get volume(){return this.quantidade*this.valor}get data(){return new Date(this._data.getTime())}paraTexto(){return`\n            Data: ${this.data},\n            Quantidade: ${this.quantidade},\n            Valor: ${this.valor}\n        `}ehIgual(e){return this.data.getDate()===e.data.getDate()&&this.data.getMonth()===e.data.getMonth()&&this.data.getFullYear()===e.data.getFullYear()}}class a{constructor(){this.negociacoes=[]}adiciona(e){this.negociacoes.push(e)}lista(){return this.negociacoes}paraTexto(){return JSON.stringify(this.negociacoes,null,2)}ehIgual(e){return JSON.stringify(this.negociacoes)===JSON.stringify(e.lista())}}class n{obterNegociacoesDoDia(){return fetch("http://localhost:8080/dados").then((e=>e.json())).then((e=>e.map((e=>new o(new Date,e.vezes,e.montante)))))}}class i{constructor(e){const t=document.querySelector(e);if(!t)throw Error(`Seletor ${e} não existe no DOM. Verifique`);this.elemento=t}update(e){let t=this.template(e);this.elemento.innerHTML=t}}class r extends i{template(e){return`\n            <p class="alert alert-info">${e}</p>\n        `}}class s extends i{template(e){return`\n        <table class="table table-hover table-bordered">\n            <thead>\n                <tr>\n                    <th>DATA</th>\n                    <th>QUANTIDADE</th>\n                    <th>VALOR</th>\n                </tr>\n            </thead>\n            <tbody>\n                ${e.lista().map((e=>`\n                        <tr>\n                            <td>${this.formatar(e.data)}\n                            </td>\n                            <td>\n                                ${e.quantidade}\n                            </td>\n                            <td>\n                                ${e.valor}\n                            </td>\n                        </tr>\n                    `)).join("")}\n            </tbody>\n        </table>\n        `}formatar(e){return(new Intl.DateTimeFormat).format(e)}}!function(e,t,o,a){var n,i=arguments.length,r=i<3?t:null===a?a=Object.getOwnPropertyDescriptor(t,o):a;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,o,a);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(r=(i<3?n(r):i>3?n(t,o,r):n(t,o))||r);i>3&&r&&Object.defineProperty(t,o,r)}([function(e,t,o){const a=o.value;return o.value=function(...e){let t=a.apply(this,e);return"string"==typeof t&&(t=t.replace(/<script>[\s\S]*?<\/script>/,"")),t},o}],s.prototype,"template",null);var c=function(e,t,o,a){var n,i=arguments.length,r=i<3?t:null===a?a=Object.getOwnPropertyDescriptor(t,o):a;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,o,a);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(r=(i<3?n(r):i>3?n(t,o,r):n(t,o))||r);return i>3&&r&&Object.defineProperty(t,o,r),r};class l{constructor(){this.negociacoes=new a,this.negociacoesView=new s("#negociacoesView"),this.mensagemView=new r("#mensagemView"),this.negociacoesService=new n,this.negociacoesView.update(this.negociacoes)}adiciona(){const e=o.criaDe(this.inputData.value,this.inputQuantidade.value,this.inputValor.value);this.ehDiaUtil(e.data)?(this.negociacoes.adiciona(e),function(...e){for(let t of e)console.log(t.paraTexto())}(e,this.negociacoes),this.limparFormulario(),this.atualizaView()):this.mensagemView.update("Apenas negociações em dias úteis são aceitas")}importaDados(){this.negociacoesService.obterNegociacoesDoDia().then((e=>e.filter((e=>!this.negociacoes.lista().some((t=>t.ehIgual(e))))))).then((e=>{for(let t of e)this.negociacoes.adiciona(t);this.negociacoesView.update(this.negociacoes)}))}ehDiaUtil(e){return e.getDay()>t.DOMINGO&&e.getDay()<t.SABADO}limparFormulario(){this.inputData.value="",this.inputQuantidade.value="",this.inputValor.value="",this.inputData.focus()}atualizaView(){this.negociacoesView.update(this.negociacoes),this.mensagemView.update("Negociação adicionada com sucesso")}}c([e("#data")],l.prototype,"inputData",void 0),c([e("#quantidade")],l.prototype,"inputQuantidade",void 0),c([e("#valor")],l.prototype,"inputValor",void 0),c([function(e,t,o){const a=o.value;return o.value=function(...e){console.log(`--- Método ${t}`),console.log(`------ parâmetros: ${JSON.stringify(e)}`);const o=a.apply(this,e);return console.log(`------ retorno: ${JSON.stringify(o)}`),o},o},function(e=!1){return function(t,o,a){const n=a.value;return a.value=function(...t){let a=1,i="milisegundos";e&&(a=1e3,i="segundos");const r=performance.now(),s=(n.apply(this,t),performance.now());console.log(`${o}, tempo de execução: ${(s-r)/a} ${i}`)},a}}()],l.prototype,"adiciona",null);const u=new l,d=document.querySelector(".form");if(!d)throw Error("Não foi possível inicializar a aplicação. Verifique se o form existe.");d.addEventListener("submit",(e=>{e.preventDefault(),u.adiciona()}));const p=document.querySelector("#botao-importa");if(!p)throw Error("Botão importa não foi encontrado");p.addEventListener("click",(()=>{u.importaDados()}))})();